FROM nginx:latest

ARG PROXY_PROTOCOL
ARG PROXY_DOMAIN
ARG PROXY_PORT
ARG PROXY_EXTERN_DOMAIN
ARG PROXY_EXTERN_PORT
ARG PROXY_SERVICE_STATIC_PATH
ARG PROXY_SERVICE_AUTH_PATH
ARG PROXY_SERVICE_IDENTITY_PATH
ARG PROXY_SERVICE_APP_PATH
ARG PROXY_SERVICE_SAFE_PATH
ARG PROXY_SERVICE_MARKETPLACE_PATH
ARG STATIC_PROTOCOL
ARG STATIC_DOMAIN
ARG STATIC_PORT
ARG APP_PROTOCOL
ARG APP_DOMAIN
ARG APP_PORT
ARG AUTH_PROTOCOL
ARG AUTH_DOMAIN
ARG AUTH_PORT
ARG IDENTITY_PROTOCOL
ARG IDENTITY_DOMAIN
ARG IDENTITY_PORT

ENV PROXY_PROTOCOL="$PROXY_PROTOCOL"
ENV PROXY_DOMAIN="$PROXY_DOMAIN"
ENV PROXY_PORT="$PROXY_PORT"
ENV PROXY_EXTERN_DOMAIN="$PROXY_EXTERN_DOMAIN"
ENV PROXY_EXTERN_PORT="$PROXY_EXTERN_PORT"
ENV PROXY_SERVICE_STATIC_PATH="$PROXY_SERVICE_STATIC_PATH"
ENV PROXY_SERVICE_AUTH_PATH="$PROXY_SERVICE_AUTH_PATH"
ENV PROXY_SERVICE_IDENTITY_PATH="$PROXY_SERVICE_IDENTITY_PATH"
ENV PROXY_SERVICE_APP_PATH="$PROXY_SERVICE_APP_PATH"
ENV PROXY_SERVICE_SAFE_PATH="$PROXY_SERVICE_SAFE_PATH"
ENV PROXY_SERVICE_MARKETPLACE_PATH="$PROXY_SERVICE_MARKETPLACE_PATH"
ENV STATIC_PROTOCOL="$STATIC_PROTOCOL"
ENV STATIC_DOMAIN="$STATIC_DOMAIN"
ENV STATIC_PORT="$STATIC_PORT"
ENV APP_PROTOCOL="$APP_PROTOCOL"
ENV APP_DOMAIN="$APP_DOMAIN"
ENV APP_PORT="$APP_PORT"
ENV AUTH_PROTOCOL="$AUTH_PROTOCOL"
ENV AUTH_DOMAIN="$AUTH_DOMAIN"
ENV AUTH_PORT="$AUTH_PORT"
ENV IDENTITY_PROTOCOL="$IDENTITY_PROTOCOL"
ENV IDENTITY_DOMAIN="$IDENTITY_DOMAIN"
ENV IDENTITY_PORT="$IDENTITY_PORT"

COPY default.sh /etc/nginx/conf.d/default.sh

RUN chmod +x /etc/nginx/conf.d/default.sh
RUN cd /etc/nginx/conf.d/ && /etc/nginx/conf.d/default.sh
RUN cat /etc/nginx/conf.d/default.conf
RUN rm -f /etc/nginx/conf.d/default.sh
